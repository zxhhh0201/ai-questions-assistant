<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini Â∏∏Áî®ÈóÆÈ¢òÂä©Êâã - È¢ÑËßà</title>
    <style>
        /* ===== Ê®°Êãü Gemini È°µÈù¢ËÉåÊôØ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #131314;
            color: #E3E3E3;
            font-family: 'Google Sans', 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }

        .gemini-mock {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            position: relative;
        }

        .gemini-greeting {
            text-align: center;
            margin-bottom: 32px;
        }

        .gemini-greeting h1 {
            font-size: 32px;
            font-weight: 400;
            background: linear-gradient(90deg, #4285F4, #A142F4, #F4B400);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .gemini-greeting p {
            color: #9AA0A6;
            font-size: 20px;
        }

        .gemini-input-mock {
            width: 600px;
            max-width: 90vw;
            background: #1E1F20;
            border-radius: 24px;
            border: 1px solid #3C4043;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .gemini-input-mock input {
            flex: 1;
            background: transparent;
            border: none;
            color: #E3E3E3;
            font-size: 16px;
            outline: none;
        }

        .gemini-input-mock input::placeholder {
            color: #5F6368;
        }

        .gemini-send-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: #3C4043;
            color: #9AA0A6;
            font-size: 16px;
            cursor: pointer;
        }

        .gemini-chips {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .gemini-chip {
            padding: 8px 16px;
            border-radius: 20px;
            background: #1E1F20;
            border: 1px solid #3C4043;
            color: #9AA0A6;
            font-size: 13px;
            cursor: pointer;
        }

        .preview-badge {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 20px;
            border-radius: 10px;
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #C4B5FD;
            font-size: 13px;
            z-index: 10;
        }
    </style>

    <!-- Êèí‰ª∂Ê†∑Âºè -->
    <style>
        /* ---------- ÊµÆÂä®Ëß¶ÂèëÊåâÈíÆ ---------- */
        #gqa-trigger-btn {
            position: fixed;
            bottom: 90px;
            right: 28px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%);
            color: #fff;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4), 0 0 0 0 rgba(139, 92, 246, 0.3);
            z-index: 999999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: gqa-pulse 2.5s infinite;
        }

        #gqa-trigger-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 28px rgba(139, 92, 246, 0.55);
            animation: none;
        }

        #gqa-trigger-btn:active {
            transform: scale(0.95);
        }

        @keyframes gqa-pulse {

            0%,
            100% {
                box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4), 0 0 0 0 rgba(139, 92, 246, 0.3);
            }

            50% {
                box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4), 0 0 0 8px rgba(139, 92, 246, 0);
            }
        }

        /* ---------- Èù¢Êùø ---------- */
        #gqa-panel {
            position: fixed;
            bottom: 150px;
            right: 28px;
            width: 400px;
            max-height: 560px;
            background: #1E1E2E;
            border: 1px solid rgba(139, 92, 246, 0.25);
            border-radius: 16px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
            z-index: 999998;
            display: none;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Google Sans', 'Segoe UI', system-ui, -apple-system, sans-serif;
            animation: gqa-slide-up 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #gqa-panel.gqa-visible {
            display: flex;
        }

        @keyframes gqa-slide-up {
            from {
                opacity: 0;
                transform: translateY(12px) scale(0.97);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .gqa-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(109, 40, 217, 0.1));
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .gqa-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gqa-header-title {
            font-size: 15px;
            font-weight: 600;
            color: #E2E8F0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gqa-header-title span.gqa-icon {
            font-size: 18px;
        }

        .gqa-header-right {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .gqa-header-btn {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.06);
            color: #94A3B8;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .gqa-header-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #E2E8F0;
        }

        .gqa-header-btn.gqa-active-mode {
            background: rgba(139, 92, 246, 0.25);
            color: #C4B5FD;
        }

        .gqa-search-box {
            padding: 10px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .gqa-search-input {
            width: 100%;
            padding: 9px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.04);
            color: #E2E8F0;
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .gqa-search-input::placeholder {
            color: #64748B;
        }

        .gqa-search-input:focus {
            border-color: rgba(139, 92, 246, 0.5);
            background: rgba(255, 255, 255, 0.06);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .gqa-tabs {
            display: flex;
            gap: 6px;
            padding: 10px 16px;
            overflow-x: auto;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            scrollbar-width: none;
        }

        .gqa-tabs::-webkit-scrollbar {
            display: none;
        }

        .gqa-tab {
            padding: 5px 14px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.03);
            color: #94A3B8;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .gqa-tab:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #CBD5E1;
        }

        .gqa-tab.gqa-active {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
            color: #C4B5FD;
        }

        .gqa-questions-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
            max-height: 300px;
        }

        .gqa-questions-list::-webkit-scrollbar {
            width: 5px;
        }

        .gqa-questions-list::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 10px;
        }

        .gqa-question-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 2px;
        }

        .gqa-question-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .gqa-question-item:active {
            background: rgba(139, 92, 246, 0.15);
        }

        .gqa-question-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .gqa-question-text {
            flex: 1;
            font-size: 13px;
            color: #CBD5E1;
            line-height: 1.5;
            word-break: break-word;
        }

        .gqa-question-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }

        .gqa-question-item:hover .gqa-question-actions {
            opacity: 1;
        }

        .gqa-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: rgba(139, 92, 246, 0.15);
            color: #C4B5FD;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .gqa-action-btn:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .gqa-action-btn.gqa-send-btn {
            background: rgba(16, 185, 129, 0.15);
            color: #6EE7B7;
        }

        .gqa-action-btn.gqa-send-btn:hover {
            background: rgba(16, 185, 129, 0.3);
        }

        .gqa-action-btn.gqa-edit-btn {
            background: rgba(59, 130, 246, 0.15);
            color: #93C5FD;
        }

        .gqa-action-btn.gqa-edit-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .gqa-action-btn.gqa-del-btn {
            background: rgba(239, 68, 68, 0.15);
            color: #FCA5A5;
        }

        .gqa-action-btn.gqa-del-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .gqa-empty {
            padding: 32px 16px;
            text-align: center;
            color: #64748B;
            font-size: 13px;
        }

        .gqa-empty-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .gqa-footer {
            padding: 8px 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .gqa-footer-text {
            font-size: 11px;
            color: #475569;
        }

        .gqa-kbd {
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 10px;
            color: #64748B;
            font-family: 'SF Mono', 'Cascadia Code', monospace;
        }

        .gqa-mode-bar {
            display: none;
            padding: 8px 16px;
            background: rgba(139, 92, 246, 0.08);
            border-bottom: 1px solid rgba(139, 92, 246, 0.15);
            gap: 8px;
            align-items: center;
        }

        .gqa-mode-bar.gqa-visible {
            display: flex;
        }

        .gqa-mode-tabs {
            display: flex;
            gap: 4px;
            flex: 1;
        }

        .gqa-mode-tab {
            padding: 4px 12px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: #94A3B8;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gqa-mode-tab:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .gqa-mode-tab.gqa-active {
            background: rgba(139, 92, 246, 0.2);
            color: #C4B5FD;
        }

        .gqa-manage-view {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .gqa-manage-view.gqa-visible {
            display: flex;
        }

        .gqa-manage-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            scrollbar-width: thin;
            max-height: 260px;
        }

        .gqa-manage-list::-webkit-scrollbar {
            width: 5px;
        }

        .gqa-manage-list::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 10px;
        }

        .gqa-cat-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 10px;
            transition: all 0.2s;
            margin-bottom: 2px;
        }

        .gqa-cat-item:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        .gqa-cat-dot {
            width: 12px;
            height: 12px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .gqa-cat-name {
            flex: 1;
            font-size: 13px;
            color: #CBD5E1;
            font-weight: 500;
        }

        .gqa-cat-count {
            font-size: 11px;
            color: #475569;
            margin-right: 4px;
        }

        .gqa-cat-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .gqa-cat-item:hover .gqa-cat-actions {
            opacity: 1;
        }

        .gqa-add-bar {
            padding: 8px 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .gqa-add-btn {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px dashed rgba(139, 92, 246, 0.3);
            background: rgba(139, 92, 246, 0.05);
            color: #A78BFA;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gqa-add-btn:hover {
            background: rgba(139, 92, 246, 0.12);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .gqa-inline-form {
            display: none;
            padding: 12px;
            margin: 4px 8px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .gqa-inline-form.gqa-visible {
            display: block;
        }

        .gqa-form-group {
            margin-bottom: 10px;
        }

        .gqa-form-group:last-child {
            margin-bottom: 0;
        }

        .gqa-form-label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: #94A3B8;
            margin-bottom: 5px;
        }

        .gqa-form-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.04);
            color: #E2E8F0;
            font-size: 13px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .gqa-form-input:focus {
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .gqa-form-input::placeholder {
            color: #475569;
        }

        textarea.gqa-form-input {
            resize: vertical;
            min-height: 60px;
        }

        .gqa-form-select {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.04);
            color: #E2E8F0;
            font-size: 13px;
            outline: none;
            cursor: pointer;
            box-sizing: border-box;
        }

        .gqa-form-select option {
            background: #1E1E2E;
            color: #CBD5E1;
        }

        .gqa-color-row {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .gqa-color-dot {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gqa-color-dot:hover {
            transform: scale(1.15);
        }

        .gqa-color-dot.gqa-selected {
            border-color: #fff;
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.5);
        }

        .gqa-form-btns {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            margin-top: 10px;
        }

        .gqa-form-btn {
            padding: 6px 14px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .gqa-form-btn-cancel {
            background: rgba(255, 255, 255, 0.06);
            color: #94A3B8;
        }

        .gqa-form-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .gqa-form-btn-save {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: #fff;
        }

        .gqa-form-btn-save:hover {
            box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
        }

        .gqa-toast {
            position: fixed;
            bottom: 160px;
            right: 40px;
            padding: 8px 18px;
            border-radius: 8px;
            background: rgba(139, 92, 246, 0.9);
            color: #fff;
            font-size: 12px;
            font-weight: 500;
            z-index: 1000000;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            font-family: inherit;
        }

        .gqa-toast.gqa-show {
            opacity: 1;
            transform: translateY(0);
        }

        #gqa-overlay {
            position: fixed;
            inset: 0;
            background: transparent;
            z-index: 999997;
            display: none;
        }

        #gqa-overlay.gqa-visible {
            display: block;
        }
    </style>
</head>

<body>

    <!-- Ê®°Êãü Gemini È°µÈù¢ -->
    <div class="gemini-mock">
        <div class="preview-badge">üîå Êèí‰ª∂ÊïàÊûúÈ¢ÑËßà ‚Äî ÁÇπÂáªÂè≥‰∏ãËßí ‚ö° ÊåâÈíÆ‰ΩìÈ™å</div>
        <div class="gemini-greeting">
            <h1>‚ú¶ ‰Ω†Â•Ω</h1>
            <p>ÈúÄË¶ÅÊàë‰∏∫‰Ω†ÂÅö‰∫õ‰ªÄ‰πàÔºü</p>
        </div>
        <div class="gemini-input-mock">
            <input type="text" id="gemini-input" placeholder="ÈóÆÈóÆ Gemini 3" />
            <button class="gemini-send-btn">‚û§</button>
        </div>
        <div class="gemini-chips">
            <span class="gemini-chip">üé® Âà∂‰ΩúÂõæÁâá</span>
            <span class="gemini-chip">Èöè‰æøÂÜôÁÇπ‰ªÄ‰πà</span>
            <span class="gemini-chip">Â∏ÆÊàëÂ≠¶‰π†</span>
            <span class="gemini-chip">Âàõ‰ΩúËßÜÈ¢ë</span>
        </div>
    </div>

    <!-- Êèí‰ª∂Ê≥®ÂÖ•ÁöÑÂÖÉÁ¥† -->
    <div id="gqa-overlay"></div>
    <button id="gqa-trigger-btn">‚ö°</button>
    <div class="gqa-toast" id="gqa-toast"></div>

    <div id="gqa-panel">
        <div class="gqa-header">
            <div class="gqa-header-left">
                <div class="gqa-header-title">
                    <span class="gqa-icon">‚ö°</span> Â∏∏Áî®ÈóÆÈ¢ò
                </div>
            </div>
            <div class="gqa-header-right">
                <button class="gqa-header-btn" id="gqa-manage-toggle" title="ÁÆ°ÁêÜÊ®°Âºè">‚öôÔ∏è</button>
                <button class="gqa-header-btn" id="gqa-close-btn" title="ÂÖ≥Èó≠">‚úï</button>
            </div>
        </div>
        <div class="gqa-mode-bar" id="gqa-mode-bar">
            <div class="gqa-mode-tabs">
                <button class="gqa-mode-tab gqa-active" data-mtab="questions">üìã ÈóÆÈ¢òÁÆ°ÁêÜ</button>
                <button class="gqa-mode-tab" data-mtab="categories">üè∑Ô∏è ÂàÜÁ±ªÁÆ°ÁêÜ</button>
            </div>
        </div>
        <div id="gqa-browse-view">
            <div class="gqa-search-box"><input type="text" class="gqa-search-input" id="gqa-search"
                    placeholder="üîç ÊêúÁ¥¢ÈóÆÈ¢ò..." /></div>
            <div class="gqa-tabs" id="gqa-tabs"></div>
            <div class="gqa-questions-list" id="gqa-questions-list"></div>
        </div>
        <div class="gqa-manage-view" id="gqa-manage-questions">
            <div class="gqa-search-box"><input type="text" class="gqa-search-input" id="gqa-manage-search"
                    placeholder="üîç ÊêúÁ¥¢ÈóÆÈ¢ò..." /></div>
            <div id="gqa-question-form" class="gqa-inline-form"></div>
            <div class="gqa-manage-list" id="gqa-manage-questions-list"></div>
            <div class="gqa-add-bar"><button class="gqa-add-btn" id="gqa-add-question-btn">Ôºã Ê∑ªÂä†Êñ∞ÈóÆÈ¢ò</button></div>
        </div>
        <div class="gqa-manage-view" id="gqa-manage-categories">
            <div id="gqa-category-form" class="gqa-inline-form"></div>
            <div class="gqa-manage-list" id="gqa-manage-categories-list"></div>
            <div class="gqa-add-bar"><button class="gqa-add-btn" id="gqa-add-category-btn">Ôºã Ê∑ªÂä†Êñ∞ÂàÜÁ±ª</button></div>
        </div>
        <div class="gqa-footer">
            <span class="gqa-footer-text">Êåâ</span><span class="gqa-kbd">Alt</span><span
                class="gqa-footer-text">+</span><span class="gqa-kbd">Q</span><span class="gqa-footer-text">Âø´ÈÄüÂàáÊç¢</span>
        </div>
    </div>

    <script>
        // Ê®°ÊãüÊï∞ÊçÆÔºàÊõø‰ª£ chrome.storageÔºâ
        const COLORS = ['#8B5CF6', '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#EC4899', '#06B6D4', '#84CC16'];

        let allCategories = [
            { id: 'research', name: 'ÁßëÁ†î', color: '#8B5CF6' },
            { id: 'writing', name: 'ÂÜô‰Ωú', color: '#10B981' },
            { id: 'coding', name: 'ÁºñÁ®ã', color: '#3B82F6' },
            { id: 'general', name: 'ÈÄöÁî®', color: '#F59E0B' }
        ];
        let allQuestions = [
            // ÁßëÁ†î
            { id: 'q1', categoryId: 'research', text: 'ËØ¶ÁªÜËÆ≤Ëß£ËøôÁØáÊñáÁ´†ÁöÑÊñπÊ≥ïÔºåÂåÖÊã¨ÊØè‰∏™ÈÉ®ÂàÜËæìÂÖ•ËæìÂá∫„ÄÅÁõÆÁöÑ„ÄÅÊ∂âÂèäÂà∞ÁöÑÂÖ¨Âºè', order: 0 },
            { id: 'q2', categoryId: 'research', text: 'ËØ∑Â∏ÆÊàëÂÆ°Á®øÔºå‰ª•ICMLÁöÑÊ†áÂáÜÔºåÁªôÂá∫ÊÄªÁªì„ÄÅadvantage„ÄÅweakness„ÄÅÂØπ‰ΩúËÄÖÁöÑquestionÔºåÂêÑÁªô‰∫î‰∏™ÔºåÊ∂µÁõñÊñπÊ≥ïÂÆåÊï¥ÊÄß„ÄÅÂàõÊñ∞ÊÄß„ÄÅÂÆûÈ™å„ÄÅÂÜô‰ΩúÁ≠âÔºå‰∏ªË¶ÅËÅöÁÑ¶ÊñπÊ≥ïÁªôÂá∫„ÄÇ', order: 1 },
            { id: 'q3', categoryId: 'research', text: 'ÁªôÂá∫ËøôÁØáÊñáÁ´†ÊòØÂú®‰ªÄ‰πàÊñáÁ´†ÁöÑÂü∫Á°Ä‰∏äÂÜôÂá∫ÁöÑÔºåÂì™‰∏ÄÈÉ®ÂàÜÂèÇËÄÉÁöÑÂì™‰∏™ÊñπÊ≥ï', order: 2 },
            { id: 'q4', categoryId: 'research', text: 'ÊÄªÁªìËøôÁØáËÆ∫ÊñáÁöÑÊ†∏ÂøÉÂàõÊñ∞ÁÇπÔºå‰∏éÁé∞ÊúâÊñπÊ≥ïÁõ∏ÊØîÊúâÂì™‰∫õÊú¨Ë¥®Âå∫Âà´Ôºü', order: 3 },
            { id: 'q5', categoryId: 'research', text: 'ÂàÜÊûêËøôÁØáËÆ∫ÊñáÂÆûÈ™åÈÉ®ÂàÜÁöÑËÆæËÆ°ÔºåËØÑ‰º∞ÂÖ∂ÂÆûÈ™åÊòØÂê¶ÂÖÖÂàÜÈ™åËØÅ‰∫ÜÊâÄÊèêÊñπÊ≥ïÁöÑÊúâÊïàÊÄß', order: 4 },
            // ÂÜô‰Ωú
            { id: 'q6', categoryId: 'writing', text: 'ËØ∑Â∏ÆÊàëÊ∂¶Ëâ≤‰ª•‰∏ãÂ≠¶ÊúØËÆ∫ÊñáÊÆµËêΩÔºå‰ΩøÂÖ∂Êõ¥Âä†‰∏ì‰∏öÂíåÂú∞ÈÅìÔºö', order: 0 },
            { id: 'q7', categoryId: 'writing', text: 'ËØ∑Â∏ÆÊàëÂ∞Ü‰ª•‰∏ã‰∏≠ÊñáÂÜÖÂÆπÁøªËØëÊàêÂ≠¶ÊúØËã±ÊñáÔºå‰øùÊåÅ‰∏ì‰∏öÊúØËØ≠ÂáÜÁ°ÆÔºö', order: 1 },
            { id: 'q8', categoryId: 'writing', text: 'ËØ∑Â∏ÆÊàëÊîπÂÜôËøôÊÆµËØùÔºå‰ΩøÂÖ∂ÈÄªËæëÊõ¥Ê∏ÖÊô∞„ÄÅË°®ËææÊõ¥ÁÆÄÊ¥ÅÔºö', order: 2 },
            { id: 'q9', categoryId: 'writing', text: 'ËØ∑Â∏ÆÊàëÂÜô‰∏ÄÊÆµËÆ∫ÊñáÁöÑ Related Work ÈÉ®ÂàÜÔºåÂõ¥Áªï‰ª•‰∏ãÂá†ÁØáÂ∑•‰ΩúÂ±ïÂºÄÔºö', order: 3 },
            { id: 'q10', categoryId: 'writing', text: 'ËØ∑Â∏ÆÊàë‰∏∫‰ª•‰∏ãÂÜÖÂÆπÊí∞ÂÜô‰∏Ä‰∏™Ê∏ÖÊô∞ÁöÑ AbstractÔºåÁ™ÅÂá∫Âä®Êú∫„ÄÅÊñπÊ≥ïÂíåÁªìÊûúÔºö', order: 4 },
            // ÁºñÁ®ã
            { id: 'q11', categoryId: 'coding', text: 'ËØ∑Â∏ÆÊàëÂÆ°Êü•‰ª•‰∏ã‰ª£Á†ÅÔºåÊåáÂá∫ÈóÆÈ¢òÂíåÊîπËøõÂª∫ËÆÆÔºö', order: 0 },
            { id: 'q12', categoryId: 'coding', text: 'ËØ∑Áî® Python ÂÆûÁé∞‰ª•‰∏ãÂäüËÉΩÔºö', order: 1 },
            { id: 'q13', categoryId: 'coding', text: 'ËØ∑Ëß£ÈáäËøôÊÆµ‰ª£Á†ÅÁöÑÂ∑•‰ΩúÂéüÁêÜÔºåÂπ∂ÈÄêË°åÊ∑ªÂä†Ê≥®ÈáäÔºö', order: 2 },
            { id: 'q14', categoryId: 'coding', text: 'ËØ∑Â∏ÆÊàë‰ºòÂåñËøôÊÆµ‰ª£Á†ÅÁöÑÊÄßËÉΩÔºåÂπ∂Ëß£Èáä‰ºòÂåñÊÄùË∑ØÔºö', order: 3 },
            { id: 'q15', categoryId: 'coding', text: 'ËØ∑Â∏ÆÊàëË∞ÉËØï‰ª•‰∏ã‰ª£Á†ÅÔºåÊâæÂá∫ bug Âπ∂ÁªôÂá∫‰øÆÂ§çÊñπÊ°àÔºö', order: 4 },
            // ÈÄöÁî®
            { id: 'q16', categoryId: 'general', text: 'ËØ∑Áî®ÁÆÄÂçïÁöÑËØ≠Ë®ÄËß£ÈáäËøô‰∏™Ê¶ÇÂøµÔºö', order: 0 },
            { id: 'q17', categoryId: 'general', text: 'ËØ∑Â∏ÆÊàëÊÄªÁªì‰ª•‰∏ãÂÜÖÂÆπÁöÑË¶ÅÁÇπÔºö', order: 1 },
            { id: 'q18', categoryId: 'general', text: 'ËØ∑ÂØπÊØî‰ª•‰∏ã‰∏§‰∏™ÈÄâÈ°πÁöÑ‰ºòÁº∫ÁÇπÔºö', order: 2 },
            { id: 'q19', categoryId: 'general', text: 'ËØ∑ÈíàÂØπ‰ª•‰∏ãÈóÆÈ¢òÊèê‰æõÂ§ö‰∏™ÂèØË°åÁöÑËß£ÂÜ≥ÊñπÊ°àÂπ∂ÂàÜÊûêÂà©ÂºäÔºö', order: 3 },
            { id: 'q20', categoryId: 'general', text: 'ËØ∑Â∏ÆÊàëÂà∂‰Ωú‰∏Ä‰∏™ÂÖ≥‰∫é‰ª•‰∏ã‰∏ªÈ¢òÁöÑÊÄùÁª¥ÂØºÂõæ/Â§ßÁ∫≤Ôºö', order: 4 }
        ];

        let panelVisible = false, manageMode = false, manageTab = 'questions', currentCategory = 'all';

        function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
        function showToast(msg) { const t = document.getElementById('gqa-toast'); t.textContent = msg; t.classList.add('gqa-show'); setTimeout(() => t.classList.remove('gqa-show'), 2000); }

        // Èù¢ÊùøÂàáÊç¢
        function togglePanel() { panelVisible ? hidePanel() : showPanel(); }
        function showPanel() {
            document.getElementById('gqa-panel').classList.add('gqa-visible');
            document.getElementById('gqa-overlay').classList.add('gqa-visible');
            panelVisible = true;
            renderCurrentView();
        }
        function hidePanel() {
            document.getElementById('gqa-panel').classList.remove('gqa-visible');
            document.getElementById('gqa-overlay').classList.remove('gqa-visible');
            panelVisible = false;
        }

        document.getElementById('gqa-trigger-btn').addEventListener('click', (e) => { e.stopPropagation(); togglePanel(); });
        document.getElementById('gqa-close-btn').addEventListener('click', hidePanel);
        document.getElementById('gqa-overlay').addEventListener('click', hidePanel);
        document.getElementById('gqa-panel').addEventListener('click', (e) => e.stopPropagation());
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && panelVisible) hidePanel(); if (e.altKey && e.key.toLowerCase() === 'q') { e.preventDefault(); togglePanel(); } });

        // ÁÆ°ÁêÜÊ®°ÂºèÂàáÊç¢
        document.getElementById('gqa-manage-toggle').addEventListener('click', () => { manageMode = !manageMode; renderCurrentView(); });
        document.querySelectorAll('.gqa-mode-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                manageTab = tab.dataset.mtab;
                document.querySelectorAll('.gqa-mode-tab').forEach(t => t.classList.remove('gqa-active'));
                tab.classList.add('gqa-active');
                renderCurrentView();
            });
        });
        document.getElementById('gqa-add-question-btn').addEventListener('click', () => showQuestionForm(null));
        document.getElementById('gqa-add-category-btn').addEventListener('click', () => showCategoryForm(null));
        document.getElementById('gqa-search').addEventListener('input', renderBrowseQuestions);
        document.getElementById('gqa-manage-search').addEventListener('input', renderManageQuestions);

        function renderCurrentView() {
            const bv = document.getElementById('gqa-browse-view');
            const mqv = document.getElementById('gqa-manage-questions');
            const mcv = document.getElementById('gqa-manage-categories');
            const mb = document.getElementById('gqa-mode-bar');
            const tb = document.getElementById('gqa-manage-toggle');
            bv.style.display = 'none'; mqv.classList.remove('gqa-visible'); mcv.classList.remove('gqa-visible');
            if (manageMode) {
                mb.classList.add('gqa-visible'); tb.classList.add('gqa-active-mode');
                if (manageTab === 'questions') { mqv.classList.add('gqa-visible'); renderManageQuestions(); }
                else { mcv.classList.add('gqa-visible'); renderManageCategories(); }
            } else {
                mb.classList.remove('gqa-visible'); tb.classList.remove('gqa-active-mode');
                bv.style.display = ''; renderTabs(); renderBrowseQuestions();
            }
        }

        // ÊµèËßàÊ®°Âºè
        function renderTabs() {
            const c = document.getElementById('gqa-tabs');
            let h = `<button class="gqa-tab ${currentCategory === 'all' ? 'gqa-active' : ''}" data-cat="all">ÂÖ®ÈÉ®</button>`;
            allCategories.forEach(cat => { h += `<button class="gqa-tab ${currentCategory === cat.id ? 'gqa-active' : ''}" data-cat="${cat.id}">${cat.name}</button>`; });
            c.innerHTML = h;
            c.querySelectorAll('.gqa-tab').forEach(tab => { tab.addEventListener('click', () => { currentCategory = tab.dataset.cat; renderTabs(); renderBrowseQuestions(); }); });
        }

        function renderBrowseQuestions() {
            const c = document.getElementById('gqa-questions-list');
            const kw = (document.getElementById('gqa-search')?.value || '').trim().toLowerCase();
            let f = allQuestions;
            if (currentCategory !== 'all') f = f.filter(q => q.categoryId === currentCategory);
            if (kw) f = f.filter(q => q.text.toLowerCase().includes(kw));
            f.sort((a, b) => (a.order || 0) - (b.order || 0));
            if (!f.length) { c.innerHTML = `<div class="gqa-empty"><div class="gqa-empty-icon">üì≠</div>${kw ? 'Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÈóÆÈ¢ò' : 'ÊöÇÊó†ÈóÆÈ¢òÔºåÁÇπÂáª ‚öôÔ∏è ËøõÂÖ•ÁÆ°ÁêÜÊ®°ÂºèÊ∑ªÂä†'}</div>`; return; }
            let h = '';
            f.forEach(q => {
                const cat = allCategories.find(cc => cc.id === q.categoryId);
                h += `<div class="gqa-question-item" data-qid="${q.id}"><span class="gqa-question-dot" style="background:${cat ? cat.color : '#64748B'}"></span><span class="gqa-question-text">${escapeHtml(q.text)}</span><div class="gqa-question-actions"><button class="gqa-action-btn" data-action="fill" title="Â°´ÂÖ•ËæìÂÖ•Ê°Ü">üìù</button><button class="gqa-action-btn gqa-send-btn" data-action="fill-send" title="Â°´ÂÖ•Âπ∂ÂèëÈÄÅ">üöÄ</button></div></div>`;
            });
            c.innerHTML = h;
            c.querySelectorAll('.gqa-question-item').forEach(item => {
                const fillFn = () => { const q = allQuestions.find(q => q.id === item.dataset.qid); if (q) { document.getElementById('gemini-input').value = q.text; hidePanel(); showToast('Â∑≤Â°´ÂÖ•ËæìÂÖ•Ê°Ü ‚úì'); } };
                item.addEventListener('click', (e) => { if (!e.target.closest('.gqa-action-btn')) fillFn(); });
                item.querySelector('[data-action="fill"]')?.addEventListener('click', (e) => { e.stopPropagation(); fillFn(); });
                item.querySelector('[data-action="fill-send"]')?.addEventListener('click', (e) => { e.stopPropagation(); const q = allQuestions.find(q => q.id === item.dataset.qid); if (q) { document.getElementById('gemini-input').value = q.text; hidePanel(); showToast('Â∑≤Â°´ÂÖ•Âπ∂ÂèëÈÄÅ ‚úì'); } });
            });
        }

        // ÁÆ°ÁêÜ - ÈóÆÈ¢ò
        function renderManageQuestions() {
            const c = document.getElementById('gqa-manage-questions-list');
            const kw = (document.getElementById('gqa-manage-search')?.value || '').trim().toLowerCase();
            let f = allQuestions;
            if (kw) f = f.filter(q => q.text.toLowerCase().includes(kw));
            if (!f.length) { c.innerHTML = `<div class="gqa-empty"><div class="gqa-empty-icon">üì≠</div>${kw ? 'Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÈóÆÈ¢ò' : 'ÊöÇÊó†ÈóÆÈ¢òÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆÊ∑ªÂä†'}</div>`; return; }
            let h = '';
            f.forEach(q => {
                const cat = allCategories.find(cc => cc.id === q.categoryId);
                h += `<div class="gqa-question-item" data-qid="${q.id}"><span class="gqa-question-dot" style="background:${cat ? cat.color : '#64748B'}"></span><div style="flex:1;min-width:0"><span class="gqa-question-text">${escapeHtml(q.text)}</span><div style="font-size:11px;color:#475569;margin-top:2px">${cat ? cat.name : 'Êú™ÂàÜÁ±ª'}</div></div><div class="gqa-question-actions" style="opacity:1"><button class="gqa-action-btn gqa-edit-btn" data-action="edit" title="ÁºñËæë">‚úèÔ∏è</button><button class="gqa-action-btn gqa-del-btn" data-action="delete" title="Âà†Èô§">üóëÔ∏è</button></div></div>`;
            });
            c.innerHTML = h;
            c.querySelectorAll('.gqa-question-item').forEach(item => {
                item.querySelector('[data-action="edit"]').addEventListener('click', () => showQuestionForm(item.dataset.qid));
                item.querySelector('[data-action="delete"]').addEventListener('click', () => { if (confirm('Á°ÆÂÆöÂà†Èô§Ëøô‰∏™ÈóÆÈ¢òÂêóÔºü')) { allQuestions = allQuestions.filter(q => q.id !== item.dataset.qid); renderManageQuestions(); showToast('ÈóÆÈ¢òÂ∑≤Âà†Èô§'); } });
            });
        }

        function showQuestionForm(editId) {
            const f = document.getElementById('gqa-question-form');
            const q = editId ? allQuestions.find(q => q.id === editId) : null;
            let opts = allCategories.map(c => `<option value="${c.id}" ${q && q.categoryId === c.id ? 'selected' : ''}>${c.name}</option>`).join('');
            f.innerHTML = `<div class="gqa-form-group"><label class="gqa-form-label">ÂàÜÁ±ª</label><select class="gqa-form-select" id="gqa-qf-cat">${opts}</select></div><div class="gqa-form-group"><label class="gqa-form-label">ÈóÆÈ¢òÂÜÖÂÆπ</label><textarea class="gqa-form-input" id="gqa-qf-text" rows="3" placeholder="ËæìÂÖ•‰Ω†ÁöÑÂ∏∏Áî®ÈóÆÈ¢ò...">${q ? escapeHtml(q.text) : ''}</textarea></div><div class="gqa-form-btns"><button class="gqa-form-btn gqa-form-btn-cancel" id="gqa-qf-cancel">ÂèñÊ∂à</button><button class="gqa-form-btn gqa-form-btn-save" id="gqa-qf-save">${q ? 'Êõ¥Êñ∞' : 'Ê∑ªÂä†'}</button></div>`;
            f.classList.add('gqa-visible');
            document.getElementById('gqa-qf-cancel').addEventListener('click', () => f.classList.remove('gqa-visible'));
            document.getElementById('gqa-qf-save').addEventListener('click', () => {
                const text = document.getElementById('gqa-qf-text').value.trim();
                const catId = document.getElementById('gqa-qf-cat').value;
                if (!text) { showToast('ËØ∑ËæìÂÖ•ÈóÆÈ¢òÂÜÖÂÆπ'); return; }
                if (q) { q.text = text; q.categoryId = catId; showToast('ÈóÆÈ¢òÂ∑≤Êõ¥Êñ∞ ‚úì'); }
                else { allQuestions.push({ id: 'q_' + Date.now(), categoryId: catId, text, order: allQuestions.length }); showToast('ÈóÆÈ¢òÂ∑≤Ê∑ªÂä† ‚úì'); }
                f.classList.remove('gqa-visible');
                renderManageQuestions();
            });
            setTimeout(() => document.getElementById('gqa-qf-text')?.focus(), 100);
        }

        // ÁÆ°ÁêÜ - ÂàÜÁ±ª
        function renderManageCategories() {
            const c = document.getElementById('gqa-manage-categories-list');
            if (!allCategories.length) { c.innerHTML = `<div class="gqa-empty"><div class="gqa-empty-icon">üè∑Ô∏è</div>ÊöÇÊó†ÂàÜÁ±ªÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆÊ∑ªÂä†</div>`; return; }
            let h = '';
            allCategories.forEach(cat => {
                const cnt = allQuestions.filter(q => q.categoryId === cat.id).length;
                h += `<div class="gqa-cat-item" data-cid="${cat.id}"><span class="gqa-cat-dot" style="background:${cat.color}"></span><span class="gqa-cat-name">${escapeHtml(cat.name)}</span><span class="gqa-cat-count">${cnt} ‰∏™ÈóÆÈ¢ò</span><div class="gqa-cat-actions" style="opacity:1"><button class="gqa-action-btn gqa-edit-btn" data-action="edit" title="ÁºñËæë">‚úèÔ∏è</button><button class="gqa-action-btn gqa-del-btn" data-action="delete" title="Âà†Èô§">üóëÔ∏è</button></div></div>`;
            });
            c.innerHTML = h;
            c.querySelectorAll('.gqa-cat-item').forEach(item => {
                item.querySelector('[data-action="edit"]').addEventListener('click', () => showCategoryForm(item.dataset.cid));
                item.querySelector('[data-action="delete"]').addEventListener('click', () => {
                    const cid = item.dataset.cid;
                    const cnt = allQuestions.filter(q => q.categoryId === cid).length;
                    if (confirm(cnt > 0 ? `ËØ•ÂàÜÁ±ª‰∏ãÊúâ ${cnt} ‰∏™ÈóÆÈ¢òÔºåÂà†Èô§ÂêéËøô‰∫õÈóÆÈ¢ò‰πü‰ºöË¢´Âà†Èô§„ÄÇÁ°ÆÂÆöÂêóÔºü` : 'Á°ÆÂÆöÂà†Èô§Ëøô‰∏™ÂàÜÁ±ªÂêóÔºü')) {
                        allCategories = allCategories.filter(c => c.id !== cid);
                        allQuestions = allQuestions.filter(q => q.categoryId !== cid);
                        renderManageCategories();
                        showToast('ÂàÜÁ±ªÂ∑≤Âà†Èô§');
                    }
                });
            });
        }

        function showCategoryForm(editId) {
            const f = document.getElementById('gqa-category-form');
            const cat = editId ? allCategories.find(c => c.id === editId) : null;
            let sel = cat ? cat.color : COLORS[0];
            let dots = COLORS.map(c => `<button type="button" class="gqa-color-dot ${c === sel ? 'gqa-selected' : ''}" data-color="${c}" style="background:${c}"></button>`).join('');
            f.innerHTML = `<div class="gqa-form-group"><label class="gqa-form-label">ÂàÜÁ±ªÂêçÁß∞</label><input type="text" class="gqa-form-input" id="gqa-cf-name" placeholder="‰æãÂ¶ÇÔºöÁøªËØë" value="${cat ? escapeHtml(cat.name) : ''}" /></div><div class="gqa-form-group"><label class="gqa-form-label">È¢úËâ≤</label><div class="gqa-color-row" id="gqa-cf-colors">${dots}</div></div><div class="gqa-form-btns"><button class="gqa-form-btn gqa-form-btn-cancel" id="gqa-cf-cancel">ÂèñÊ∂à</button><button class="gqa-form-btn gqa-form-btn-save" id="gqa-cf-save">${cat ? 'Êõ¥Êñ∞' : 'Ê∑ªÂä†'}</button></div>`;
            f.classList.add('gqa-visible');
            let picked = sel;
            f.querySelectorAll('.gqa-color-dot').forEach(d => { d.addEventListener('click', (e) => { e.preventDefault(); picked = d.dataset.color; f.querySelectorAll('.gqa-color-dot').forEach(dd => dd.classList.remove('gqa-selected')); d.classList.add('gqa-selected'); }); });
            document.getElementById('gqa-cf-cancel').addEventListener('click', () => f.classList.remove('gqa-visible'));
            document.getElementById('gqa-cf-save').addEventListener('click', () => {
                const name = document.getElementById('gqa-cf-name').value.trim();
                if (!name) { showToast('ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞'); return; }
                if (cat) { cat.name = name; cat.color = picked; showToast('ÂàÜÁ±ªÂ∑≤Êõ¥Êñ∞ ‚úì'); }
                else { allCategories.push({ id: 'cat_' + Date.now(), name, color: picked }); showToast('ÂàÜÁ±ªÂ∑≤Ê∑ªÂä† ‚úì'); }
                f.classList.remove('gqa-visible');
                renderManageCategories();
            });
            setTimeout(() => document.getElementById('gqa-cf-name')?.focus(), 100);
        }
    </script>
</body>

</html>